<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0"> 
    <title>Cricket Scorer - Fixed Player Names</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: Arial, sans-serif; }
        body { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); min-height: 100vh; padding: 20px; }
        .container { max-width: 1000px; margin: 0 auto; background: white; border-radius: 15px; box-shadow: 0 20px 40px rgba(0,0,0,0.1); overflow: hidden; }
        .header { background: #1a365d; color: white; padding: 30px; text-align: center; }
        .header h1 { font-size: 2.5rem; margin-bottom: 10px; }
        .menu { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; padding: 30px; }
        .card { background: #f8fafc; border: 2px solid #e2e8f0; border-radius: 12px; padding: 25px; text-align: center; cursor: pointer; transition: all 0.3s; }
        .card:hover { transform: translateY(-5px); border-color: #4299e1; box-shadow: 0 10px 25px rgba(66, 153, 225, 0.15); }
        .card h3 { color: #2d3748; margin-bottom: 10px; font-size: 1.3rem; }
        .card p { color: #718096; line-height: 1.5; }
        .hidden { display: none; }
        .screen { padding: 30px; }
        .btn { background: #4299e1; color: white; padding: 12px 25px; border: none; border-radius: 8px; cursor: pointer; margin: 10px; font-size: 16px; font-weight: bold; }
        .btn:hover { background: #3182ce; }
        .form-group { margin: 15px 0; }
        .form-input { width: 100%; padding: 12px; border: 2px solid #cbd5e0; border-radius: 8px; font-size: 16px; }
        .form-input:focus { border-color: #4299e1; outline: none; }
        
        /* Team Setup Styles */
        .team-setup-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .team-section {
            background: #f8fafc;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e2e8f0;
        }

        .player-list {
            max-height: 300px;
            overflow-y: auto;
            margin: 15px 0;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 10px;
        }

        .player-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
            cursor: pointer;
        }

        .player-item:hover {
            background: #ebf8ff;
            border-color: #4299e1;
        }

        .player-item.selected {
            background: #4299e1;
            color: white;
        }

        .player-role {
            font-size: 0.8rem;
            color: #718096;
            background: #f7fafc;
            padding: 2px 8px;
            border-radius: 12px;
        }

        .player-item.selected .player-role {
            background: rgba(255,255,255,0.2);
            color: white;
        }

        .batting-order {
            margin: 15px 0;
        }

        .order-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .order-number {
            background: #4299e1;
            color: white;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .bowling-lineup {
            margin: 15px 0;
        }

        .bowler-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            margin: 5px 0;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }

        .small-btn { padding: 8px 15px; font-size: 14px; margin: 5px; }
        
        /* Tournament specific styles */
        .tournament-card { border: 1px solid #e2e8f0; padding: 15px; margin: 10px 0; border-radius: 8px; background: #f8fafc; }
        .tournament-card h4 { margin: 0 0 10px 0; color: #2d3748; }
        .tournament-card p { margin: 5px 0; color: #4a5568; }
        
        /* Add Player Form Styles */
        .add-player-form {
            background: #f0fff4;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 2px dashed #68d391;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 2fr 1fr 1fr;
            gap: 10px;
            margin-bottom: 10px;
        }
        
        .player-type-options {
            display: flex;
            gap: 10px;
            margin: 10px 0;
        }
        
        .player-type-btn {
            flex: 1;
            padding: 8px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            background: white;
            cursor: pointer;
            text-align: center;
        }
        
        .player-type-btn.selected {
            background: #4299e1;
            color: white;
            border-color: #4299e1;
        }
        
        /* Over Selection Styles */
        .over-selection {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 10px;
            margin: 15px 0;
        }
        
        .over-option {
            padding: 10px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            background: white;
        }
        
        .over-option.selected {
            background: #4299e1;
            color: white;
            border-color: #4299e1;
        }
        
        .team-size-info {
            background: #fffaf0;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #ed8936;
        }

        /* Live Scoring Styles */
        .scoring-buttons {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(80px, 1fr));
            gap: 8px;
            margin-top: 10px;
        }

        .scoring-btn {
            padding: 12px 8px;
            border: none;
            border-radius: 6px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 14px;
        }

        .scoring-btn:hover {
            transform: scale(1.05);
        }

        .run-btn {
            background: #d1fae5;
            color: #065f46;
            border: 2px solid #a7f3d0;
        }

        .wicket-btn {
            background: #fee2e2;
            color: #991b1b;
            border: 2px solid #fecaca;
        }

        .extra-btn {
            background: #fef3c7;
            color: #92400e;
            border: 2px solid #fde68a;
        }

        .control-btn {
            background: #e0e7ff;
            color: #3730a3;
            border: 2px solid #c7d2fe;
        }

        .player-status {
            background: #f7fafc;
            padding: 12px;
            border-radius: 8px;
            border-left: 4px solid #4299e1;
            margin: 10px 0;
        }

        .ball-dot {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin: 0 2px;
            text-align: center;
            line-height: 20px;
            font-size: 12px;
            font-weight: bold;
        }

        .ball-run { background: #d1fae5; color: #065f46; }
        .ball-wicket { background: #fee2e2; color: #991b1b; }
        .ball-extra { background: #fef3c7; color: #92400e; }
        .ball-dot-ball { background: #e2e8f0; color: #4a5568; }
    </style>
</head>
<body>
    <div class="container">
        <!-- Home Screen -->
        <div class="header">
            <h1>üèè CRICHIT - Cricket Scorer</h1>
            <p>Professional Cricket Scoring Application</p>
        </div>

        <div id="homeScreen">
            <div class="menu">
                <div class="card" onclick="showScreen('setup')">
                    <h3>‚ûï New Match</h3>
                    <p>Start scoring a new cricket match with live updates and player statistics</p>
                </div>
                
                <div class="card" onclick="showScreen('teamSetup')">
                    <h3>üë• Team Setup</h3>
                    <p>Create teams with 5-11 players, batting order, bowling lineup</p>
                </div>
                
                <div class="card" onclick="showScreen('tournaments')">
                    <h3>üèÜ Tournaments</h3>
                    <p>Create and manage cricket tournaments</p>
                </div>
            </div>
        </div>

        <!-- Setup Screen -->
        <div id="setupScreen" class="screen hidden">
            <h2>üéØ New Match Setup</h2>
            <div class="form-group">
                <input type="text" class="form-input" placeholder="üèè Team A Name" id="teamA">
            </div>
            <div class="form-group">
                <input type="text" class="form-input" placeholder="üèè Team B Name" id="teamB">
            </div>
            
            <div class="form-group">
                <h3>Select Overs</h3>
                <div class="over-selection">
                    <div class="over-option selected" data-overs="5" onclick="selectOvers(5)">5 Overs</div>
                    <div class="over-option" data-overs="6" onclick="selectOvers(6)">6 Overs</div>
                    <div class="over-option" data-overs="7" onclick="selectOvers(7)">7 Overs</div>
                    <div class="over-option" data-overs="8" onclick="selectOvers(8)">8 Overs</div>
                    <div class="over-option" data-overs="10" onclick="selectOvers(10)">10 Overs</div>
                    <div class="over-option" data-overs="15" onclick="selectOvers(15)">15 Overs</div>
                    <div class="over-option" data-overs="20" onclick="selectOvers(20)">20 Overs</div>
                </div>
            </div>
            
            <button class="btn" onclick="startMatch()">üöÄ Start Match</button>
            <button class="btn" onclick="showScreen('home')" style="background: #718096;">‚Üê Back to Home</button>
        </div>

        <!-- Team Setup Screen -->
        <div id="teamSetupScreen" class="screen hidden">
            <div style="text-align: center; margin-bottom: 30px;">
                <h2>üë• Team Setup</h2>
                <p>Create complete teams with players (5-11 players), batting order, bowling lineup</p>
            </div>

            <div class="card">
                <h3>üèè Create New Team</h3>
                <div class="form-group">
                    <input type="text" class="form-input" placeholder="Team Name" id="teamName">
                </div>
                
                <!-- Add Player Form -->
                <div class="add-player-form">
                    <h4>‚ûï Add New Player</h4>
                    <div class="form-row">
                        <input type="text" class="form-input" placeholder="Player Name" id="newPlayerName">
                        <input type="text" class="form-input" placeholder="Role (e.g., Opening Batsman)" id="newPlayerRole">
                        <button class="btn small-btn" onclick="addNewPlayer()" style="background: #38a169;">Add Player</button>
                    </div>
                    <div class="player-type-options">
                        <div class="player-type-btn selected" data-type="batsman" onclick="selectPlayerType('batsman')">Batsman</div>
                        <div class="player-type-btn" data-type="bowler" onclick="selectPlayerType('bowler')">Bowler</div>
                        <div class="player-type-btn" data-type="allrounder" onclick="selectPlayerType('allrounder')">All-Rounder</div>
                        <div class="player-type-btn" data-type="wicketkeeper" onclick="selectPlayerType('wicketkeeper')">Wicket Keeper</div>
                    </div>
                </div>
                
                <div class="team-size-info">
                    <p>üéØ <strong>Team Size:</strong> Select between 5 to 11 players for your team</p>
                    <p>üìä <strong>Current Selection:</strong> <span id="selectedCount">0</span>/11 players</p>
                </div>
                
                <div class="team-setup-container">
                    <!-- Available Players Section -->
                    <div class="team-section">
                        <h4>Available Players</h4>
                        <div class="player-list" id="availablePlayers">
                            <p style="color: #666; text-align: center;">No players added yet. Use the form above to add players.</p>
                        </div>
                    </div>

                    <!-- Selected Players Section -->
                    <div class="team-section">
                        <h4>Selected Players</h4>
                        <div class="player-list" id="selectedPlayers">
                            <p style="color: #666; text-align: center;">No players selected</p>
                        </div>
                        <button class="btn small-btn" onclick="clearSelection()" style="background: #e53e3e;">
                            Clear All
                        </button>
                    </div>
                </div>

                <!-- Batting Order -->
                <div class="batting-order">
                    <h4>ü¶á Batting Order</h4>
                    <div id="battingOrderList">
                        <p style="color: #666; text-align: center;">Select players first to set batting order</p>
                    </div>
                </div>

                <!-- Bowling Lineup -->
                <div class="bowling-lineup">
                    <h4>üéØ Bowling Lineup</h4>
                    <div id="bowlingLineupList">
                        <p style="color: #666; text-align: center;">Select bowlers from your team</p>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="saveTeam()" style="background: #38a169;">
                        üíæ Save Team
                    </button>
                    <button class="btn" onclick="showScreen('home')" style="background: #718096;">
                        ‚Üê Back to Home
                    </button>
                </div>
            </div>

            <div class="card">
                <h3>üìã Saved Teams</h3>
                <div id="savedTeamsList">
                    <p style="color: #666; text-align: center;">No teams saved yet</p>
                </div>
            </div>
        </div>

        <!-- Live Scoring Screen -->
        <div id="scoringScreen" class="screen hidden">
            <div style="text-align: center; margin-bottom: 20px;">
                <h2>üéØ Live Match Scoring</h2>
                <div id="matchInfo" style="font-size: 1.2rem; margin: 10px 0;"></div>
            </div>
            
            <div class="card">
                <div class="player-status">
                    <h3>üèè Current Batsmen</h3>
                    <div id="currentBatsmen" style="margin: 10px 0;">
                        <p>Striker: <span id="striker">Not Set</span> - Runs: <span id="strikerRuns">0</span></p>
                        <p>Non-Striker: <span id="nonStriker">Not Set</span> - Runs: <span id="nonStrikerRuns">0</span></p>
                    </div>
                </div>
                
                <div class="player-status">
                    <h3>üéØ Current Bowler</h3>
                    <div id="currentBowler" style="margin: 10px 0;">
                        <p>Bowler: <span id="bowlerName">Not Set</span> - Overs: <span id="bowlerOvers">0</span></p>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <h2 id="scoreDisplay">Team: 0/0 (0.0 Overs)</h2>
                    <div id="recentBalls" style="margin: 10px 0;">
                        <p>Recent Balls: <span id="ballHistory"></span></p>
                    </div>
                </div>
                
                <h3>Scoring Buttons</h3>
                <div class="scoring-buttons">
                    <button class="scoring-btn run-btn" onclick="addRuns(0)">0</button>
                    <button class="scoring-btn run-btn" onclick="addRuns(1)">1</button>
                    <button class="scoring-btn run-btn" onclick="addRuns(2)">2</button>
                    <button class="scoring-btn run-btn" onclick="addRuns(3)">3</button>
                    <button class="scoring-btn run-btn" onclick="addRuns(4)">4</button>
                    <button class="scoring-btn run-btn" onclick="addRuns(6)">6</button>
                    <button class="scoring-btn wicket-btn" onclick="addWicket()">W</button>
                    <button class="scoring-btn extra-btn" onclick="addExtra('wide')">Wd</button>
                    <button class="scoring-btn extra-btn" onclick="addExtra('noball')">Nb</button>
                    <button class="scoring-btn extra-btn" onclick="addExtra('bye')">Bye</button>
                    <button class="scoring-btn control-btn" onclick="changeStrike()">‚≠Æ Strike</button>
                    <button class="scoring-btn control-btn" onclick="changeBowler()">üîÑ Bowler</button>
                </div>
                
                <div style="text-align: center; margin-top: 20px;">
                    <button class="btn" onclick="endInnings()" style="background: #e53e3e;">
                        üèÅ End Innings
                    </button>
                    <button class="btn" onclick="showScreen('home')" style="background: #718096;">
                        ‚Üê Back to Home
                    </button>
                </div>
            </div>
        </div>

        <!-- Tournament Screen -->
        <div id="tournamentsScreen" class="screen hidden">
            <h2>üèÜ Tournaments</h2>
            <div class="card">
                <h3>Create New Tournament</h3>
                <div class="form-group">
                    <input type="text" class="form-input" placeholder="Tournament Name" id="tournamentName">
                </div>
                <div class="form-group">
                    <select class="form-input" id="tournamentType">
                        <option>Round Robin</option>
                        <option>Knockout</option>
                        <option>League + Playoffs</option>
                    </select>
                </div>
                <button class="btn" onclick="createTournament()">Create Tournament</button>
            </div>
            
            <div class="card">
                <h3>Your Tournaments</h3>
                <div id="tournamentList">
                    <p style="color: #666; text-align: center;">No tournaments created yet</p>
                </div>
            </div>
            
            <button class="btn" onclick="showScreen('home')" style="background: #718096;">‚Üê Back to Home</button>
        </div>
    </div>

    <script>
        // Global variables
        let currentTeam = {
            name: '',
            players: [],
            battingOrder: [],
            bowlingLineup: [],
            fieldingPositions: {}
        };

        let availablePlayers = [];
        let selectedPlayerType = 'batsman';
        let selectedOvers = 5;
        let matchState = null;
        let savedTeams = [];

        // Screen navigation
        function showScreen(screenName) {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.add('hidden');
            });
            
            document.getElementById(screenName + 'Screen').classList.remove('hidden');
            
            if(screenName !== 'home') {
                document.getElementById('homeScreen').classList.add('hidden');
            } else {
                document.getElementById('homeScreen').classList.remove('hidden');
            }

            if(screenName === 'teamSetup') {
                initializeTeamSetup();
            }
        }

        // Team Setup Functions
        function initializeTeamSetup() {
            loadAvailablePlayers();
            updateAvailablePlayersList();
            updateSavedTeamsList();
        }

        function loadAvailablePlayers() {
            const storedPlayers = localStorage.getItem('players');
            availablePlayers = storedPlayers ? JSON.parse(storedPlayers) : [];
        }

        function updateAvailablePlayersList() {
            const availablePlayersList = document.getElementById('availablePlayers');
            
            if (availablePlayers.length === 0) {
                availablePlayersList.innerHTML = '<p style="color: #666; text-align: center;">No players added yet. Use the form above to add players.</p>';
                return;
            }
            
            availablePlayersList.innerHTML = availablePlayers.map(player => `
                <div class="player-item" onclick="selectPlayer(${player.id})">
                    <div>
                        <strong>${player.name}</strong>
                        <div class="player-role">${player.role || player.type}</div>
                    </div>
                    <div style="font-size: 0.8rem; color: #718096;">
                        ${player.type}
                    </div>
                </div>
            `).join('');
        }

        function selectPlayerType(type) {
            selectedPlayerType = type;
            document.querySelectorAll('.player-type-btn').forEach(btn => {
                btn.classList.remove('selected');
            });
            document.querySelector(`.player-type-btn[data-type="${type}"]`).classList.add('selected');
        }

        function addNewPlayer() {
            const playerName = document.getElementById('newPlayerName').value;
            const playerRole = document.getElementById('newPlayerRole').value;
            
            if (!playerName) {
                alert('Please enter a player name');
                return;
            }
            
            const newPlayer = {
                id: Date.now(),
                name: playerName,
                type: selectedPlayerType,
                role: playerRole || selectedPlayerType
            };
            
            availablePlayers.push(newPlayer);
            localStorage.setItem('players', JSON.stringify(availablePlayers));
            updateAvailablePlayersList();
            
            document.getElementById('newPlayerName').value = '';
            document.getElementById('newPlayerRole').value = '';
            alert(`Player "${playerName}" added successfully!`);
        }

        function selectPlayer(playerId) {
            if (currentTeam.players.length >= 11) {
                alert('Team already has maximum 11 players.');
                return;
            }

            const player = availablePlayers.find(p => p.id === playerId);
            if (player && !currentTeam.players.find(p => p.id === playerId)) {
                currentTeam.players.push(player);
                updateSelectedPlayersList();
                updateBattingOrderList();
                updateBowlingLineupList();
            }
        }

        function removePlayer(playerId) {
            currentTeam.players = currentTeam.players.filter(p => p.id !== playerId);
            currentTeam.battingOrder = currentTeam.battingOrder.filter(p => p.id !== playerId);
            currentTeam.bowlingLineup = currentTeam.bowlingLineup.filter(p => p.id !== playerId);
            updateSelectedPlayersList();
            updateBattingOrderList();
            updateBowlingLineupList();
        }

        function updateSelectedPlayersList() {
            const selectedPlayersList = document.getElementById('selectedPlayers');
            const selectedCount = document.getElementById('selectedCount');
            
            selectedCount.textContent = currentTeam.players.length;
            
            if (currentTeam.players.length === 0) {
                selectedPlayersList.innerHTML = '<p style="color: #666; text-align: center;">No players selected</p>';
                return;
            }

            selectedPlayersList.innerHTML = currentTeam.players.map(player => `
                <div class="player-item">
                    <div>
                        <strong>${player.name}</strong>
                        <div class="player-role">${player.role || player.type}</div>
                    </div>
                    <button class="small-btn" onclick="removePlayer(${player.id})" 
                            style="background: #e53e3e; color: white; border: none; padding: 4px 8px; border-radius: 4px;">
                        Remove
                    </button>
                </div>
            `).join('');
        }

        function updateBattingOrderList() {
            const battingOrderList = document.getElementById('battingOrderList');
            
            if (currentTeam.players.length === 0) {
                battingOrderList.innerHTML = '<p style="color: #666; text-align: center;">Select players first to set batting order</p>';
                return;
            }

            if (currentTeam.battingOrder.length === 0) {
                const batsmen = currentTeam.players.filter(p => p.type === 'batsman' || p.type === 'wicketkeeper');
                const allrounders = currentTeam.players.filter(p => p.type === 'allrounder');
                const bowlers = currentTeam.players.filter(p => p.type === 'bowler');
                currentTeam.battingOrder = [...batsmen, ...allrounders, ...bowlers];
            }

            battingOrderList.innerHTML = currentTeam.battingOrder.map((player, index) => `
                <div class="order-item">
                    <div class="order-number">${index + 1}</div>
                    <div style="flex: 1; margin-left: 10px;">
                        <strong>${player.name}</strong>
                        <div class="player-role">${player.role || player.type}</div>
                    </div>
                    <div style="display: flex; gap: 5px;">
                        <button class="small-btn" onclick="movePlayerUp(${index})" 
                                ${index === 0 ? 'disabled' : ''}
                                style="background: #4299e1; color: white; border: none; padding: 4px 8px; border-radius: 4px;">
                            ‚Üë
                        </button>
                        <button class="small-btn" onclick="movePlayerDown(${index})" 
                                ${index === currentTeam.battingOrder.length - 1 ? 'disabled' : ''}
                                style="background: #4299e1; color: white; border: none; padding: 4px 8px; border-radius: 4px;">
                            ‚Üì
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function movePlayerUp(index) {
            if (index > 0) {
                [currentTeam.battingOrder[index], currentTeam.battingOrder[index-1]] = 
                [currentTeam.battingOrder[index-1], currentTeam.battingOrder[index]];
                updateBattingOrderList();
            }
        }

        function movePlayerDown(index) {
            if (index < currentTeam.battingOrder.length - 1) {
                [currentTeam.battingOrder[index], currentTeam.battingOrder[index+1]] = 
                [currentTeam.battingOrder[index+1], currentTeam.battingOrder[index]];
                updateBattingOrderList();
            }
        }

        function updateBowlingLineupList() {
            const bowlingLineupList = document.getElementById('bowlingLineupList');
            const bowlers = currentTeam.players.filter(p => p.type === 'bowler' || p.type === 'allrounder');
            
            if (bowlers.length === 0) {
                bowlingLineupList.innerHTML = '<p style="color: #666; text-align: center;">No bowlers in the team</p>';
                return;
            }

            if (currentTeam.bowlingLineup.length === 0) {
                currentTeam.bowlingLineup = bowlers;
            }

            bowlingLineupList.innerHTML = currentTeam.bowlingLineup.map((player, index) => `
                <div class="bowler-item">
                    <div>
                        <strong>${player.name}</strong>
                        <div class="player-role">${player.role || player.type}</div>
                    </div>
                    <div style="font-size: 0.8rem; color: #718096;">
                        ${index === 0 ? 'üéØ Opening' : 'üéØ Bowler'}
                    </div>
                </div>
            `).join('');
        }

        function clearSelection() {
            currentTeam = {
                name: '',
                players: [],
                battingOrder: [],
                bowlingLineup: [],
                fieldingPositions: {}
            };
            updateSelectedPlayersList();
            updateBattingOrderList();
            updateBowlingLineupList();
        }

        function saveTeam() {
            function saveTeam() {
    const teamName = document.getElementById('teamName').value;
    
    if (!teamName) {
        alert('Please enter a team name');
        return;
    }

    if (currentTeam.players.length < 5) {
        alert('Please select at least 5 players for the team');
        return;
    }

    // Ensure battingOrder is saved properly - YEH NAYA CODE
    if (currentTeam.battingOrder.length === 0 && currentTeam.players.length > 0) {
        const batsmen = currentTeam.players.filter(p => p.type === 'batsman' || p.type === 'wicketkeeper');
        const allrounders = currentTeam.players.filter(p => p.type === 'allrounder');
        const bowlers = currentTeam.players.filter(p => p.type === 'bowler');
        currentTeam.battingOrder = [...batsmen, ...allrounders, ...bowlers];
    }

    currentTeam.name = teamName;
    currentTeam.id = Date.now();
    currentTeam.createdAt = new Date().toLocaleDateString();

    const savedTeams = getSavedTeams();
    savedTeams.push(currentTeam);
    localStorage.setItem('saved_teams', JSON.stringify(savedTeams));

    alert(`üéâ Team "${teamName}" saved successfully with ${currentTeam.players.length} players!`);
    updateSavedTeamsList();
    clearSelection();
    document.getElementById('teamName').value = '';
}

        function getSavedTeams() {
            const data = localStorage.getItem('saved_teams');
            return data ? JSON.parse(data) : [];
        }

        function updateSavedTeamsList() {
            const savedTeamsList = document.getElementById('savedTeamsList');
            const savedTeams = getSavedTeams();
            
            if (savedTeams.length === 0) {
                savedTeamsList.innerHTML = '<p style="color: #666; text-align: center;">No teams saved yet</p>';
                return;
            }

            savedTeamsList.innerHTML = savedTeams.map(team => `
                <div class="tournament-card">
                    <h4>${team.name}</h4>
                    <p>üë• ${team.players.length} Players</p>
                    <p>üìÖ Created: ${team.createdAt}</p>
                    <button class="btn small-btn" onclick="loadTeam(${team.id})" style="background: #4299e1;">
                        Load Team
                    </button>
                    <button class="btn small-btn" onclick="deleteTeam(${team.id})" style="background: #e53e3e;">
                        Delete
                    </button>
                </div>
            `).join('');
        }

        function loadTeam(teamId) {
            const savedTeams = getSavedTeams();
            const team = savedTeams.find(t => t.id === teamId);
            if (team) {
                currentTeam = JSON.parse(JSON.stringify(team));
                document.getElementById('teamName').value = team.name;
                updateSelectedPlayersList();
                updateBattingOrderList();
                updateBowlingLineupList();
                alert(`Team "${team.name}" loaded successfully!`);
            }
        }

        function deleteTeam(teamId) {
            if (confirm('Are you sure you want to delete this team?')) {
                const savedTeams = getSavedTeams();
                const filtered = savedTeams.filter(t => t.id !== teamId);
                localStorage.setItem('saved_teams', JSON.stringify(filtered));
                updateSavedTeamsList();
                alert('Team deleted successfully!');
            }
        }

        // Match Setup Functions
        function selectOvers(overs) {
            selectedOvers = overs;
            document.querySelectorAll('.over-option').forEach(option => {
                option.classList.remove('selected');
            });
            document.querySelector(`.over-option[data-overs="${overs}"]`).classList.add('selected');
        }

        function startMatch() {
            function startMatch() {
    const teamA = document.getElementById('teamA').value;
    const teamB = document.getElementById('teamB').value;
    
    if(!teamA || !teamB) {
        alert('Please enter both team names');
        return;
    }

    // Get saved teams data
    const savedTeams = getSavedTeams();
    const teamAData = savedTeams.find(team => team.name === teamA);
    const teamBData = savedTeams.find(team => team.name === teamB);

    if (!teamAData || !teamBData) {
        alert('Please create both teams first in Team Setup');
        return;
    }

    const tossWinner = Math.random() > 0.5 ? teamA : teamB;
    const decision = Math.random() > 0.5 ? 'bat' : 'bowl';
    const battingTeam = decision === 'bat' ? tossWinner : (tossWinner === teamA ? teamB : teamA);
    const bowlingTeam = battingTeam === teamA ? teamB : teamA;

    // Get actual players from saved teams
    const battingTeamData = battingTeam === teamA ? teamAData : teamBData;
    const bowlingTeamData = bowlingTeam === teamA ? teamAData : teamBData;

    console.log('Batting Team Data:', battingTeamData); // Debugging
    console.log('Batting Order:', battingTeamData.battingOrder); // Debugging

    matchState = {
        teamA: teamA,
        teamB: teamB,
        battingTeam: battingTeam,
        bowlingTeam: bowlingTeam,
        battingTeamData: battingTeamData,
        bowlingTeamData: bowlingTeamData,
        innings: 1,
        totalRuns: 0,
        wickets: 0,
        overs: 0,
        balls: 0,
        maxOvers: selectedOvers,
        currentStriker: { name: 'Select Player', runs: 0 },
        currentNonStriker: { name: 'Select Player', runs: 0 },
        currentBowler: { name: 'Select Bowler', overs: 0 },
        ballHistory: []
    };

    // Set actual players for batting team - YEH PART FIX KARO
    if (battingTeamData.battingOrder && battingTeamData.battingOrder.length > 0) {
        matchState.currentStriker = { 
            name: battingTeamData.battingOrder[0].name, 
            runs: 0,
            playerData: battingTeamData.battingOrder[0]
        };
    }
    
    if (battingTeamData.battingOrder && battingTeamData.battingOrder.length > 1) {
        matchState.currentNonStriker = { 
            name: battingTeamData.battingOrder[1].name, 
            runs: 0,
            playerData: battingTeamData.battingOrder[1]
        };
    } else if (battingTeamData.battingOrder && battingTeamData.battingOrder.length === 1) {
        // Agar sirf ek player hai batting order me
        matchState.currentNonStriker = { 
            name: 'No Player Available', 
            runs: 0
        };
    }

    // Set actual bowler
    if (bowlingTeamData.bowlingLineup && bowlingTeamData.bowlingLineup.length > 0) {
        matchState.currentBowler = { 
            name: bowlingTeamData.bowlingLineup[0].name, 
            overs: 0,
            playerData: bowlingTeamData.bowlingLineup[0]
        };
    }

    document.getElementById('matchInfo').textContent = 
        `${matchState.teamA} vs ${matchState.teamB} | ${matchState.battingTeam} batting first | ${selectedOvers} overs match`;
    
    updateScoringDisplay();
    showScreen('scoring');
}

        // Live Scoring Functions
        function updateScoringDisplay() {
            if (!matchState) return;
            
            document.getElementById('scoreDisplay').textContent = 
                `${matchState.battingTeam}: ${matchState.totalRuns}/${matchState.wickets} (${matchState.overs}.${matchState.balls} Overs)`;
            
            document.getElementById('striker').textContent = matchState.currentStriker.name;
            document.getElementById('strikerRuns').textContent = matchState.currentStriker.runs;
            document.getElementById('nonStriker').textContent = matchState.currentNonStriker.name;
            document.getElementById('nonStrikerRuns').textContent = matchState.currentNonStriker.runs;
            document.getElementById('bowlerName').textContent = matchState.currentBowler.name;
            document.getElementById('bowlerOvers').textContent = matchState.currentBowler.overs;
            
            const ballHistory = document.getElementById('ballHistory');
            ballHistory.innerHTML = matchState.ballHistory.map(ball => {
                let className = 'ball-dot-ball';
                if (ball.runs > 0) className = 'ball-run';
                if (ball.wicket) className = 'ball-wicket';
                if (ball.extra) className = 'ball-extra';
                
                let displayText = ball.wicket ? 'W' : (ball.extra ? ball.extra : ball.runs);
                return `<span class="ball-dot ${className}">${displayText}</span>`;
            }).join('');
        }

        function addRuns(runs) {
            if (!matchState) return;
            
            matchState.totalRuns += runs;
            matchState.currentStriker.runs += runs;
            matchState.balls++;
            
            if (matchState.balls === 6) {
                matchState.overs++;
                matchState.balls = 0;
                // Change strike at end of over
                const temp = matchState.currentStriker;
                matchState.currentStriker = matchState.currentNonStriker;
                matchState.currentNonStriker = temp;
            } else if (runs % 2 === 1) {
                // Change strike on odd runs
                const temp = matchState.currentStriker;
                matchState.currentStriker = matchState.currentNonStriker;
                matchState.currentNonStriker = temp;
            }
            
            matchState.ballHistory.push({ runs: runs, wicket: false, extra: null });
            if (matchState.ballHistory.length > 6) {
                matchState.ballHistory.shift();
            }
            
            updateScoringDisplay();
            checkInningsEnd();
        }

        function addWicket() {
            if (!matchState) return;
            
            matchState.wickets++;
            matchState.balls++;
            
            if (matchState.balls === 6) {
                matchState.overs++;
                matchState.balls = 0;
            }
            
            matchState.ballHistory.push({ runs: 0, wicket: true, extra: null });
            if (matchState.ballHistory.length > 6) {
                matchState.ballHistory.shift();
            }
            
            updateScoringDisplay();
            checkInningsEnd();
        }

        function addExtra(extraType) {
            if (!matchState) return;
            
            matchState.totalRuns += 1;
            
            if (extraType === 'bye') {
                matchState.balls++;
                if (matchState.balls === 6) {
                    matchState.overs++;
                    matchState.balls = 0;
                }
            }
            
            matchState.ballHistory.push({ runs: 1, wicket: false, extra: extraType });
            if (matchState.ballHistory.length > 6) {
                matchState.ballHistory.shift();
            }
            
            updateScoringDisplay();
        }

        function changeStrike() {
            if (!matchState) return;
            const temp = matchState.currentStriker;
            matchState.currentStriker = matchState.currentNonStriker;
            matchState.currentNonStriker = temp;
            updateScoringDisplay();
        }

        function changeBowler() {
            if (!matchState) return;
            
            // Get next bowler from bowling team
            const currentBowlerIndex = matchState.bowlingTeamData.bowlingLineup.findIndex(
                player => player.name === matchState.currentBowler.name
            );
            
            let nextBowlerIndex = (currentBowlerIndex + 1) % matchState.bowlingTeamData.bowlingLineup.length;
            
            matchState.currentBowler = { 
                name: matchState.bowlingTeamData.bowlingLineup[nextBowlerIndex].name, 
                overs: 0,
                playerData: matchState.bowlingTeamData.bowlingLineup[nextBowlerIndex]
            };
            
            updateScoringDisplay();
        }

        function checkInningsEnd() {
            if (!matchState) return;
            
            if (matchState.wickets >= 10 || (matchState.overs >= matchState.maxOvers && matchState.balls === 0)) {
                endInnings();
            }
        }

        function endInnings() {
            if (!matchState) return;
            
            if (matchState.innings === 1) {
                alert(`First innings completed! ${matchState.battingTeam} scored ${matchState.totalRuns}/${matchState.wickets}`);
                
                // Switch innings
                matchState.innings = 2;
                const temp = matchState.battingTeam;
                matchState.battingTeam = matchState.bowlingTeam;
                matchState.bowlingTeam = temp;
                
                // Swap team data
                const tempData = matchState.battingTeamData;
                matchState.battingTeamData = matchState.bowlingTeamData;
                matchState.bowlingTeamData = tempData;
                
                matchState.totalRuns = 0;
                matchState.wickets = 0;
                matchState.overs = 0;
                matchState.balls = 0;
                matchState.ballHistory = [];
                
                // Set new batsmen
                if (matchState.battingTeamData.battingOrder.length > 0) {
                    matchState.currentStriker = { 
                        name: matchState.battingTeamData.battingOrder[0].name, 
                        runs: 0,
                        playerData: matchState.battingTeamData.battingOrder[0]
                    };
                }
                if (matchState.battingTeamData.battingOrder.length > 1) {
                    matchState.currentNonStriker = { 
                        name: matchState.battingTeamData.battingOrder[1].name, 
                        runs: 0,
                        playerData: matchState.battingTeamData.battingOrder[1]
                    };
                }
                
                document.getElementById('matchInfo').textContent = 
                    `${matchState.teamA} vs ${matchState.teamB} | ${matchState.battingTeam} batting | Target: ${matchState.totalRuns + 1} runs`;
                
                updateScoringDisplay();
            } else {
                alert('Match completed!');
                showScreen('home');
            }
        }

        // Tournament Functions
        function createTournament() {
            const name = document.getElementById('tournamentName').value;
            if (name) {
                alert(`Tournament "${name}" created successfully!`);
                document.getElementById('tournamentName').value = '';
            } else {
                alert('Please enter a tournament name');
            }
        }

        // Initialize the app
        document.addEventListener('DOMContentLoaded', function() {
            selectPlayerType('batsman');
            selectOvers(5);
        });
    </script>
</body>
</html>
